generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url = env("DATABASE_URL")
}

model User {
  id                 String         @id @default(uuid())
  email              String         @unique
  password           String
  firstName          String
  lastName           String
  phoneNumber        String         @default("0781234568")
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  otp                String?
  otpExpiresAt       DateTime? 
  photo              String         @default("https://img.freepik.com/premium-vector/user-profile-icon-flat-style-member-avatar-vector-illustration-isolated-background-human-permission-sign-business-concept_157943-15752.jpg")
  userRoles          UserRole[]
  likes              Likes[]  
  testimonials       Testimony[]
  agents              Agents[]
  company            CompanyUser?
  notification       Notification[]

  suppliers          Suppliers[]
  purchaseOrders     PurchaseOrders[]
  invoices           Invoices[]
  registeredBy       StockReceipts[]    @relation("RegisteredBy")
  receivedBy         StockReceipts[]    @relation("ReceivedBy")
  stockBatches       StockBatches[]
  stockSerials        StockSerials[]
  approvals           Approvals[]

  createdSuppliers Items[] @relation("CreatedSuppliers")
  updatedSuppliers Items[] @relation("UpdatedSuppliers")
}



enum RoleType {
  ADMIN
  AGENT
  COMPANY_ADMIN
  COMPANY_USER
  DEVELOPER
  ADMINISTRATOR
  MANAGER
  STAFF
  CLIENT
}

model UserRole {
  id          String  @id @default(uuid())
  userId      String
  name        RoleType
  user        User    @relation(fields: [userId], references: [id])
}

model ItemCategories {
  id                 String         @id @default(uuid())
  category_name      String         @unique
  description        String?
  items              Items[]
}

model UnitsOfMeasure {
  id                 String         @id @default(uuid())
  uom_name           String         @unique
  abbreviation       String?        @unique
  items              Items[]
}

model Currencies {
  id                 String         @id @default(uuid())
  currency_code      String         @unique

  invoices           Invoices[]

  StockReceipts StockReceipts[]

  PurchaseOrders PurchaseOrders[]
}

model ConditionTypes {
  id                 String         @id @default(uuid())
  condition_name     String         @unique
  description        String?
  stockReciepts      StockReceipts[]
 
}

model TemperatureRequirements {
  id                 String         @id @default(uuid())
  temp_req_name      String         @unique
  min_temp_celsius   Decimal? 	    @db.Decimal(5, 2)  
  max_temp_celsius   Decimal? 	    @db.Decimal(5, 2) 
  items              Items[]       
}

model Suppliers {
  id                 String         @id @default(uuid())
  supplier_name      String         
  contact_person     String
  phone_number       String 
  email              String         @unique 
  address            String? 
  is_active          Boolean        @default(true) 
  created_at         DateTime       @default(now()) 
  created_by_user_id String 
  created_by_user    User           @relation(fields: [created_by_user_id], references: [id])
  purchaseOrders     PurchaseOrders[]
  stockReciepts      StockReceipts[]

  Invoices Invoices[]
}

model Items {
  id                 String         @id @default(uuid())
  item_code_sku      String         @unique        
  item_full_name     String
  category_id        String 
  category           ItemCategories @relation(fields: [category_id], references: [id]) 
  description        String?          
  brand_manufacturer String? 
  barcode_qr_code    String 
  pack_size          Decimal? 	    @db.Decimal(10, 2) 
  uom_id             String 
  uom                UnitsOfMeasure @relation(fields: [uom_id], references: [id])
  temp_req_id        String 
  temp               TemperatureRequirements @relation(fields: [temp_req_id], references: [id])
  is_active          Boolean        @default(true) 
  created_at         DateTime       @default(now()) 
  created_by_user_id String 
  created_by_user    User           @relation("CreatedSuppliers",fields: [created_by_user_id], references: [id])
  updated_at         DateTime       @updatedAt
  updated_by_user_id String? 
  updated_by_user    User?          @relation("UpdatedSuppliers",fields: [updated_by_user_id], references: [id])
  stockReciepts      StockReceipts[]
}

model StorageLocations {
  id                 String         @id @default(uuid())
  location_name      String         
  location_type      String? 	      
  description        String? 
  stockReciepts      StockReceipts[]	    
 
}

model PurchaseOrders {
  id                 String         @id @default(uuid())
  po_number          String         @unique         
  location_type      String 	      
  supplier_id        String 
  supplier           Suppliers      @relation(fields: [supplier_id], references: [id])
  order_date         DateTime       @default(now())
  expected_delivery_date DateTime?  
  total_amount       Decimal?       @db.Decimal(18, 2)
  currency_id        String
  currency           Currencies     @relation(fields: [currency_id], references: [id])
  status             String
  created_at         DateTime       @default(now()) 
  created_by_user_id String
  created_by_user    User           @relation(fields: [created_by_user_id], references: [id])
  invoices           Invoices[]	
  stockReciepts      StockReceipts[]
}

model Invoices {
  id                 String         @id @default(uuid())
  invoice_number     String         @unique 
  po_id              String?           
  purchaseOrder      PurchaseOrders? @relation(fields: [po_id], references: [id]) 
  supplier_id        String           
  supplier           Suppliers?      @relation(fields: [supplier_id], references: [id])        
  invoice_date       DateTime 
  total_amount       Decimal         @db.Decimal(18, 2)	      
  description        String 
  currency_id        String
  currency           Currencies      @relation(fields: [currency_id], references: [id])
  created_at         DateTime        @default(now()) 
  created_by_user_id String
  created_by_user    User            @relation(fields: [created_by_user_id], references: [id])
  stockReciepts      StockReceipts[]
}

model StockReceipts {
  id                 String          @id @default(uuid())
  form_code          String? 
  item_id            String           
  item               Items           @relation(fields: [item_id], references: [id])     
  po_id              String?           
  purchaseOrder      PurchaseOrders? @relation(fields: [po_id], references: [id])   
  invoice_id         String?           
  invoice            Invoices?       @relation(fields: [invoice_id], references: [id])   
  supplier_id        String           
  supplier           Suppliers       @relation(fields: [supplier_id], references: [id])  
  date_received      DateTime 
  quantity_received  Decimal         @db.Decimal(10, 2)  
  unit_cost          Decimal         @db.Decimal(18, 4)  
  total_cost         Decimal         @db.Decimal(18, 2)
  currency_id        String
  currency           Currencies      @relation(fields: [currency_id], references: [id])
  condition_id       String
  condition          ConditionTypes  @relation(fields: [condition_id], references: [id])
  storage_location_id String
  storage_location   StorageLocations @relation(fields: [storage_location_id], references: [id])    
  special_handling_notes      String? 	      
  remarks_notes       String?
  registered_by_user_id String 
  registered_by_user_by_user    User  @relation("RegisteredBy",fields: [registered_by_user_id], references: [id])
  received_by_user_id String 
  received_by_user    User            @relation("ReceivedBy",fields: [received_by_user_id], references: [id])
  created_at          DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  stockBatches        StockBatches[]
  stockSerials        StockSerials[]
  approvals           Approvals[]	    
}

model StockBatches {
  id                 String         @id @default(uuid())
  receipt_id         String
  stock_receipts     StockReceipts  @relation(fields: [receipt_id], references: [id])
  batch_lot_number   String
  expiry_date        DateTime?
  quantity_in_batch  Decimal         @db.Decimal(10, 2) 
  current_stock_quantity Decimal     @db.Decimal(10, 2) @default(0.00)
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt        
  updated_by_user_id String? 
  updated_by_user    User?           @relation(fields: [updated_by_user_id], references: [id])

  @@unique([receipt_id, batch_lot_number])
}

model StockSerials {
  id                 String         @id @default(uuid())
  receipt_id         String
  stock_receipts     StockReceipts  @relation(fields: [receipt_id], references: [id])
  serial_number      String         @unique
  current_status     SerialsStatus        @default(IN_STOCK)
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt        
  updated_by_user_id String? 
  updated_by_user    User?          @relation(fields: [updated_by_user_id], references: [id])

}

enum SerialsStatus {
  IN_STOCK
  ISSUED
  DAMAGED
}

model Approvals {
  id                 String         @id @default(uuid())
  receipt_id         String
  stock_receipts     StockReceipts  @relation(fields: [receipt_id], references: [id])
  approved_by_user_id String 
  approved_by_user    User          @relation(fields: [approved_by_user_id], references: [id])
  date_approved      DateTime         
  approval_status    String        
  comments           String?       
  createdAt          DateTime       @default(now())     
}



model Notification {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  title       String
  message     String
  type        NotificationType @default(info)
  isRead      Boolean  @default(false)
  actionUrl   String?  @db.VarChar(500)

  entityType  String?  @db.VarChar(50)
  entityId    String?
  metadata    Json?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([createdAt])
  @@index([isRead])
  @@index([userId, isRead], name: "idx_user_unread")
  @@index([entityType, entityId], name: "idx_entity")
  @@index([userId, entityType, entityId], name: "idx_user_entity")
}

enum NotificationType {
  info
  success
  warning
  error
}


model Services {
  id                      String           @id @default(uuid())
  title                   String
  description             String
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
}

model Testimony {
  id                      String           @id @default(uuid())
  name                    String
  message                 String
  photo                   String?
  rating                  Int?
  reviewsId               String?
  agentReviewId           String?
  userId                  String?
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  reviews                 Reviews?       @relation(fields: [reviewsId], references: [id])
  agentReviews            AgentReview?   @relation(fields: [agentReviewId], references: [id])
  user                    User? @relation(fields: [userId], references: [id])
}

model Reviews {
  id                      String           @id @default(uuid())
  productId              String           @unique
  count                   Int           @default(0)       
  rating                  Float            
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  product                Product         @relation(fields: [productId], references: [id])
  testimonials            Testimony[]
}

model Contact {
  id        String   @id @default(cuid())
  name      String
  email     String
  company   String?
  message   String
  status           ContactStatus @default(PENDING)  
  conversationId   String?  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  replies   ContactReply[]

  @@index([email])
  @@index([conversationId])
}

model ContactReply {
  id         String   @id @default(cuid())
  contact    Contact  @relation(fields: [contactId], references: [id])
  contactId  String
  message    String
  adminName  String? 
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

enum ContactStatus {
  PENDING
  RESOLVED
}

enum ProductCategory {
  WOMENS_FASHION
  MENS_FASHION
  FASHION
  ELECTRONICS
  FURNITURES
  MADE_IN_RWANDA
  HOME_AND_LIVING
  SUPERMARKETING
  MOBILES_AND_TABLETS
  COMPUTERS_AND_GAMING
  HEALTH_AND_BEAUTY
  SPORTS_EQUIPMENT
  ART_AND_ENTERTAINMENT
  RESTAURANTS
  JEWELRY_AND_WATCHES
  KIDS_AND_BABIES
  AUTO_SPARE_PARTS
  VEHICLES_SHOPPING
}

enum OrderStatus {
  PENDING
  CONFIRMED
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
  SUCCEEDED
  CANCELED
}

enum PaymentMethod {
  CARD
  CASH_ON_DELIVERY
  MOBILE_MONEY
  AIRTEL_MONEY
  BANK_TRANSFER
  MTN_MOBILE_MONEY
}

enum DeliveryStatus {
  PENDING
  DISPATCHED
  IN_TRANSIT
  DELIVERED
  RETURNED
}



model Faq {
  id                      String           @id @default(uuid())
  question                String
  solution                String
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
}

model Blog {
  id                      String           @id @default(uuid())
  title                   String
  thumbnail               String
  teaser                  String
  description             String
  category                String
  likes                   Int           @default(0)
  views                   Int           @default(0)
  featured                Boolean
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt      
  likesModel              Likes[]            
}

model Likes {
  id                      String           @id  @default(uuid())
  userId                  String
  blogId                  String
  blog                    Blog @relation(fields: [blogId], references: [id])  
  user                    User @relation(fields: [userId], references: [id])  
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt    

  @@unique([blogId, userId])
}

model Ads {
  id                      String           @id @default(uuid())
  thumbnail               String
  title                   String
  location                String
  description             String
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
}

model Agents {
  id                      String           @id @default(uuid())
  userId                  String
  description             String  
  experience              String
  speciality              String[]
  whatsapp                String
  joined                  String
  languages               String
  about                   String
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt  
  user                    User @relation(fields: [userId], references: [id])
  agentReviews            AgentReview? 
  enquiryProperty         EnquiryProperty[]               
}

model AgentReview {
  id                      String           @id @default(uuid())
  agentId                 String           @unique
  count                   Int           @default(0)       
  rating                  Float         @default(0.0) 
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  agent                   Agents         @relation(fields: [agentId], references: [id])
  testimonials            Testimony[]
}


model Product {
  id                      String           @id @default(uuid())
  name                    String
  isFeatured                Boolean  @default(true)
  description             String
  teaser                  String
  model                   String?
  warranty                   String?
  brand                   String?
  category                ProductCategory
  price                   Float  
  featuresOne            String?
  featuresTwo            String?
  featuresThree          String?
  featuresFour           String?
  featuresFive           String?
  featuresFix            String?
  featuresSeven          String?
  featuresEight          String?
  featuresNine           String?
  featuresTen            String?
  discountPercentage      Float? 
  stockQuantity           Int      @default(0)
  isActive                Boolean  @default(true)
  thumbnail               String
  galleryImages           String[] @default([])
  rating                  Float?   @default(4.5)
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  reviews                 Reviews?
  orderItem               OrderItem[]
}


model EnquiryProperty {
  id                      String           @id @default(uuid())
  agentId                 String           @unique
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  agent                   Agents         @relation(fields: [agentId], references: [id])
}

model Order {
  id             String       @id @default(uuid())
  orderNumber    String
  status         OrderStatus  @default(PENDING)
  totalAmount    Float
  subTotal       Float
  deliveryFee    Float? 
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  orderItems     OrderItem[]
  payment        Payment?
  delivery       Delivery?
}


model OrderItem {
  id         String   @id @default(uuid())
  orderId    String
  productId  String
  discount       Float? 
  quantity   Int      @default(1)
  unitPrice  Float    
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id])
}

model Payment {
  id           String        @id @default(uuid())
  orderId      String        @unique
  amount       Float
  kind         String
  method       PaymentMethod
  status       PaymentStatus @default(PENDING)
  paidAt       DateTime?
  accountNumber String
  accountProvider String?
  refId        String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  order        Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model Delivery {
  id             String         @id @default(uuid())
  orderId        String         @unique
  address        String
  city           String
  province       String
  country        String
  postalCode     String
  customerFirstName   String
  customerLastName   String
  customerEmail  String
  customerPhone  String
  customerNote   String?
  deliveryStatus DeliveryStatus @default(PENDING)
  estimatedDate  DateTime?
  deliveredAt    DateTime?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  order          Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)
}


model Company {
  id             String          @id @default(uuid())
  name           String
  email          String        @unique
  phoneNumber    String        @unique
  industry       String?
  website        String?       
  TIN            String        @unique
  type           String
  certificate    String
  logo           String?
  country        String
  province       String
  district       String
  sector         String
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  CompanyUser    CompanyUser[]
  drugs        Drugs[]
  drugsCategories DrugsCategories[]
  insurance      Insurance[]
}

model CompanyUser {
  id           String      @id @default(uuid())
  companyId    String
  userId       String      @unique
  title        String?
  idNumber     String?
  idAttachment String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  company      Company  @relation(fields: [companyId], references: [id])
  user         User     @relation(fields: [userId], references: [id])
}

model DrugsCategories {
  id           String      @id @default(uuid())
  companyId    String
  name         String 
  company      Company  @relation(fields: [companyId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  drugs        Drugs[]
}

model Drugs {
  id           String      @id @default(uuid())
  companyId    String
  drugCategoryId String?
  drugCode       String
  description    String
  designation    String
  instruction    String

  company      Company  @relation(fields: [companyId], references: [id])
  drugCategory  DrugsCategories? @relation(fields: [drugCategoryId], references: [id], onDelete: SetNull)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Patient {
  id                 String          @id @default(uuid())
  name               String
  identificationType String
  phone              String
  gender             String
  birthDate          DateTime
  patientNO          String          @unique
  NID                String
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  companyId          String
  address            PatientAddress[]
  insuranceCards     InsuranceCard[]
}

model PatientAddress {
  id          String   @id @default(uuid())
  patientId   String
  city        String
  street      String
  country     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  patient     Patient  @relation(fields: [patientId], references: [id])
}

model InsuranceCard {
  id            String   @id @default(uuid())
  companyId     String
  patientId     String
  insuranceId     String
  cardNumber    String   @unique
  expireDate    DateTime
  beneficiary   String
  isOwner       Boolean
  expired       Boolean  @default(false)
  deletedAt     DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
  patient       Patient  @relation(fields: [patientId], references: [id])
  insurance     Insurance  @relation(fields: [insuranceId], references: [id])
  insuranceDetails InsuranceDetail[]
}

model InsuranceDetail {
  id              String   @id @default(uuid())
  insuranceCardId String
  key             String
  value           String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  insuranceCard   InsuranceCard @relation(fields: [insuranceCardId], references: [id])
}

model Supplier {
  id            String   @id @default(uuid())
  full_names    String
  phone_number  String
  location      String
  companyId     String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
  deletedAt     DateTime?
}

model Insurance {
  id           String      @id @default(uuid())
  companyId    String
  name         String
  percentage   Float        @default(0.0)
  company      Company      @relation(fields: [companyId], references: [id])
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  insuranceCard InsuranceCard[]
}